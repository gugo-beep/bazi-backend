// gugo-beep/backend/backend-4be0ba13368314c6714a4251deaaa86cb07287d8/src/update-frontend-mock.js

import { generateBaziProfile } from './baziService.js';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

// ä»»åŠ¡ 3.2: è„šæœ¬ç°åœ¨å¯ä»¥æ¥æ”¶å¤šç§æ ¼å¼çš„è¾“å…¥
const userInput = process.argv[2]; 
const genderArg = process.argv[3];

if (!userInput || !genderArg) {
    console.error("\nâŒ é”™è¯¯ï¼šè¯·æä¾›æ—¥æœŸå’Œæ€§åˆ«ï¼");
    console.error("ç”¨æ³•ç¤ºä¾‹:");
    console.error("  å…¬å†: node src/update-frontend-mock.js \"1996-04-13 00:18:00\" å¥³");
    console.error("  å†œå†: node src/update-frontend-mock.js \"lunar:1996-2-26\" å¥³");
    console.error("  å››æŸ±: node src/update-frontend-mock.js \"pillars:ä¸™å­-å£¬è¾°-åºšç”³-ä¸™å­\" ç”·\n");
    process.exit(1);
}

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const frontendMockFilePath = path.resolve(__dirname, '../../bazi-frontend/src/app/mock-bazi-data.ts');
const localOutputPath = path.resolve(__dirname, '../bazi-output.json');

async function updateMock() {
    console.log(`ğŸš€ å¼€å§‹ä¸º "${userInput}" (${genderArg}) ç”Ÿæˆæ•°æ®å¹¶æ›´æ–°å‰ç«¯...`);
    try {
        // å°†ç”¨æˆ·è¾“å…¥ç›´æ¥ä¼ é€’ç»™ baziService
        const baziData = await generateBaziProfile(userInput, genderArg);
        
        const tsFileContent = `// [Auto-generated by bazi-backend]\n// Case: ${userInput} (${genderArg})\n// Last updated: ${new Date().toLocaleString()}\n\nimport { BaziData } from "./bazi.interface";\n\nexport const mockBaziData: BaziData = ${JSON.stringify(baziData, null, 2)};\n`;

        fs.writeFileSync(frontendMockFilePath, tsFileContent);
        fs.writeFileSync(localOutputPath, JSON.stringify(baziData, null, 2));

        console.log(`\nâœ… å…¨éƒ¨æˆåŠŸï¼`);
        console.log(` -> å‰ç«¯ mock æ–‡ä»¶å·²æ›´æ–°: ${frontendMockFilePath}`);
        console.log(` -> æœ¬åœ° JSON æ–‡ä»¶å·²ç”Ÿæˆ: ${localOutputPath}`);

        process.exit(0);
    } catch (error) {
        console.error("\næ›´æ–°å‰ç«¯ mock æ–‡ä»¶æ—¶å‡ºé”™:", error);
        process.exit(1);
    }
}

updateMock();